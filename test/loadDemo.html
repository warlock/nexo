<html>
<head>
<script src="../nexo.js"></script>
</head>
<body>
  <div id="main"></div>
  <div class="main2">clickme</div>
  <div id="main3"></div>
  <div id="main4"></div>
  <script>

n.set({
  name : "article",
  html : (n, article) => `
  <div><strong>TITLE: ${article.title}</strong><br>
  ${n.get('articleContent', article.content)}
  </div>`
})

n.set({
  name : "articleContent",
  load : (n, content, render) => {
    setTimeout(() => {
      render(content.toUpperCase())
    }, 2000)
  },
  html : (n, content) => `<div id="${content}">${content}</div>`,
  ready : (n, content) => {
    n.on(n.id(content), 'click', () => {
      console.log(`Clicked: ${content}`)
    })
  }
})


n.set({
  name: 'fetchNews',
  load: (n, data, render) => {
    console.log(`Fetch data from url: ${data}`)
    setTimeout(() => {
      var recibedArticles = [
        { title : "Title 1", content : 'aaa'},
        { title : "Title 2", content : 'bbb'}
      ]

      render(recibedArticles)
    }, 2000)
  },
  html : (n, data) => {
    var text = `<div>LATEST NEWS(${data.length}):</div>`
    data.forEach(article => {
      text += `<div>${n.get('article', article)}</div>`
    })
    return text
  },
  ready : (n, data) => {
    console.log(`Fetch ${data.length} articles.`)
  }
})

n.ready(() => {
  n.render('fetchNews', 'main4', 'http://url')

  n.on('.main2', 'click', () => {
    n.emit('eventTest', 'from ready function')
  })
})
  </script>
</body>
</html>
